# 抽取数量限制一致性修复

## 问题描述

用户反馈：**抽奖名单里有17个项目，在抽奖配置页面，配置抽取数量时，输入大于10的数字会提示"数量错误，抽取数量必须在1-10之间"，但是抽取数量输入框下方的提示信息显示"单次抽奖的项目数量（最多17个）"。**

## 问题分析

存在两个不一致的地方：

1. **配置页面提示信息**：显示"最多17个"（基于项目总数）
2. **卡牌页面验证逻辑**：限制"必须在1-10之间"（基于卡牌布局限制）

这导致用户困惑：配置时被告知可以选择17个，但实际提交时却被限制在10个以内。

## 根本原因

**卡牌抽奖模式的特殊限制**：
- 卡牌翻转游戏由于布局和用户体验考虑，最多只支持10张卡牌
- 但配置页面没有区分不同抽奖模式的限制差异
- 提示信息统一显示项目总数作为上限，忽略了模式特定的限制

## 解决方案

### 1. 动态提示信息

**修复前**：
```typescript
<p className="text-sm text-gray-500">
  单次抽取的项目数量（最多 {allowRepeat ? 100 : items.length} 个）
</p>
```

**修复后**：
```typescript
<p className="text-sm text-gray-500">
  单次抽取的项目数量（{selectedMode === 'card-flip' ? '卡牌模式最多10个' : `最多 ${allowRepeat ? 100 : items.length} 个`}）
</p>
```

### 2. 输入框最大值限制

**修复前**：
```typescript
<Input
  max={allowRepeat ? 100 : items.length}
  onChange={(e) => setQuantity(Math.max(1, Number.parseInt(e.target.value) || 1))}
/>
```

**修复后**：
```typescript
<Input
  max={selectedMode === 'card-flip' ? 10 : (allowRepeat ? 100 : items.length)}
  onChange={(e) => {
    const value = Number.parseInt(e.target.value) || 1
    const maxValue = selectedMode === 'card-flip' ? 10 : (allowRepeat ? 100 : items.length)
    setQuantity(Math.max(1, Math.min(value, maxValue)))
  }}
/>
```

### 3. 提交时验证

**修复前**：
```typescript
const handleStartDraw = () => {
  // 只有通用验证，没有模式特定验证
  if (quantity > items.length && !allowRepeat) {
    // 错误提示
  }
}
```

**修复后**：
```typescript
const handleStartDraw = () => {
  // 卡牌模式的特殊验证
  if (selectedMode === 'card-flip' && quantity > 10) {
    toast({
      title: "数量错误",
      description: "卡牌抽奖模式最多支持10张卡牌",
      variant: "destructive",
    })
    return
  }
  
  // 其他通用验证...
}
```

## 修复效果

### 用户体验改善

**修复前的用户流程**：
1. 用户选择卡牌抽奖模式
2. 看到提示"最多17个"
3. 输入15个
4. 点击开始抽奖
5. 收到错误："必须在1-10之间" ❌ **用户困惑**

**修复后的用户流程**：
1. 用户选择卡牌抽奖模式
2. 看到提示"卡牌模式最多10个" ✅ **清晰明确**
3. 输入15个，自动限制为10个 ✅ **智能限制**
4. 点击开始抽奖
5. 成功进入抽奖 ✅ **流程顺畅**

### 不同模式的行为

| 抽奖模式 | 最大数量 | 提示信息 | 限制原因 |
|---------|---------|---------|---------|
| 卡牌抽取式 | 10个 | "卡牌模式最多10个" | 布局和用户体验限制 |
| 老虎机式 | 17个 | "最多17个" | 项目总数限制 |
| 盲盒式 | 17个 | "最多17个" | 项目总数限制 |
| 弹幕滚动式 | 17个 | "最多17个" | 项目总数限制 |
| 扭蛋机式 | 17个 | "最多17个" | 项目总数限制 |

## 技术实现

### 修改的文件
- `app/draw-config/page.tsx` - 配置页面的动态限制逻辑

### 核心改进
1. **智能提示** - 根据选择的模式显示正确的数量限制
2. **实时限制** - 输入时自动限制最大值，防止无效输入
3. **二次验证** - 提交时进行模式特定的验证检查

## 验证结果

✅ **提示信息一致性** - 配置页面和验证逻辑完全一致
✅ **用户体验优化** - 消除了用户困惑，流程更加顺畅
✅ **智能输入限制** - 防止用户输入无效数量
✅ **模式感知** - 不同抽奖模式显示对应的限制信息

## 用户反馈预期

**修复前**：
> "为什么配置时说最多17个，但提交时却说只能10个？这太混乱了！"

**修复后**：
> "选择卡牌模式时清楚地显示最多10个，其他模式显示最多17个，很清晰！"

---

**修复状态**: ✅ 完成  
**用户问题**: ✅ 已解决  
**一致性**: ✅ 已优化

现在抽取数量的限制和提示信息在所有页面都完全一致，用户不会再遇到混乱的提示信息！